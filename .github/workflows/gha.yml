name: Build aarch64 Executable

on:
  workflow_dispatch:                  # 手动触发
  
jobs:
  build-arm64:
    runs-on: ubuntu-24.04-arm
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Upgrade pip & install PyInstaller
        run: |
          python3 -m pip install --upgrade pip setuptools wheel
          pip3 install pyinstaller==6.10.0   # 固定一个在 ARM64 上肯定没问题的版本

      - name: PyInstaller build (single file, no console window)
        run: |
          pyinstaller -F 1.py     
      - name: Show build result
        run: |
          echo "=== Build completed ==="
          ls -lh dist/
          file dist/1
          ldd dist/1 || true

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: cf-socks5-linux-aarch64
          path: dist/1
          if-no-files-found: error
