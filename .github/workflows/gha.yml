name: Build aarch64 Executable

on:
  workflow_dispatch:                  # 手动触发
  
jobs:
  build-arm64:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/catthehacker/ubuntu:act-22.04-arm64   # 方式②
      options: --platform linux/arm64

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Upgrade pip & install PyInstaller
        run: |
          python3 -m pip install --upgrade pip setuptools wheel
          pip3 install pyinstaller==6.10.0   # 固定一个在 ARM64 上肯定没问题的版本

      - name: PyInstaller build (single file, no console window)
        run: |
          pyinstaller --onefile \
                      --clean \
                      --noconsole \                  # 去掉这行就有终端窗口
                      --name cf-socks5 \
                      cf_socks.py                     # ←←← 你的脚本文件名（请确保和实际一样）

      - name: Show build result
        run: |
          echo "=== Build completed ==="
          ls -lh dist/
          file dist/cf-socks5
          ldd dist/cf-socks5 || true

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: cf-socks5-linux-aarch64
          path: dist/cf-socks5
          if-no-files-found: error
